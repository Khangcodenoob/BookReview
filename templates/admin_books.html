{% extends 'base.html' %}
{% block title %}Quản trị sách{% endblock %}
{% block content %}
<div class="admin-header">
  <h2>Quản trị sách</h2>
  <p class="muted">Chỉ dành cho admin</p>
    <a class="btn" href="{{ url_for('admin_books_new') }}">+ Thêm sách</a>
    <form method="post" action="{{ url_for('admin_seed_demo') }}" onsubmit="return confirm('Thêm sách demo?')" style="display:inline-block;margin-left:8px">
      <button class="btn secondary" type="submit">Seed sách demo</button>
    </form>
    <form method="post" action="{{ url_for('admin_fix_book_codes') }}" onsubmit="return confirm('Tự sinh mã sách mất?')" style="display:inline-block;margin-left:8px">
      <button class="btn secondary" type="submit">Tự sinh mã sách mất</button>
    </form>
  <form method="post" action="{{ url_for('admin_generate_long_reviews') }}" onsubmit="return confirm('Tạo review mẫu dài cho các sách chưa có review?')" style="display:inline-block;margin-left:8px">
    <button class="btn secondary" type="submit">Tạo review mẫu dài</button>
  </form>
  <form method="post" action="{{ url_for('admin_generate_long_summaries') }}" onsubmit="return confirm('Tạo/cập nhật tóm tắt dài cho các sách mô tả ngắn?')" style="display:inline-block;margin-left:8px">
    <button class="btn secondary" type="submit">Tạo tóm tắt dài</button>
  </form>
</div>

<!-- Thống kê tổng quan -->
<div class="admin-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 24px 0;">
  <div class="stat-card" style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center;">
    <div style="font-size: 32px; font-weight: 800; color: var(--primary); margin-bottom: 8px;">{{ books|length }}</div>
    <div style="color: var(--muted); font-size: 14px;">Tổng số sách</div>
  </div>
  <div class="stat-card" style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center;">
    <div style="font-size: 32px; font-weight: 800; color: var(--accent); margin-bottom: 8px;">{{ books|selectattr('genre')|list|length }}</div>
    <div style="color: var(--muted); font-size: 14px;">Sách có thể loại</div>
  </div>
  <div class="stat-card" style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center;">
    <div style="font-size: 32px; font-weight: 800; color: #fbbf24; margin-bottom: 8px;">{{ books|selectattr('book_code')|list|length }}</div>
    <div style="color: var(--muted); font-size: 14px;">Sách có mã</div>
  </div>
  <div class="stat-card" style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center;">
    <div style="font-size: 32px; font-weight: 800; color: #ef4444; margin-bottom: 8px;">{{ books|rejectattr('book_code')|list|length }}</div>
    <div style="color: var(--muted); font-size: 14px;">Sách thiếu mã</div>
  </div>
</div>

<div style="margin:8px 0;display:flex;gap:8px;align-items:center">
  <span class="muted">Sắp xếp:</span>
  <a class="btn secondary" href="{{ url_for('admin_books', sort='title_asc') }}">A → Z (Tiêu đề)</a>
  <a class="btn secondary" href="{{ url_for('admin_books', sort='title_desc') }}">Z → A (Tiêu đề)</a>
  <a class="btn secondary" href="{{ url_for('admin_books', sort='id_asc') }}">ID ↑</a>
  <a class="btn secondary" href="{{ url_for('admin_books', sort='id_desc') }}">ID ↓</a>
</div>
<table class="table">
  <thead>
    <tr>
      <th>ID</th><th>Mã</th><th>Tiêu đề</th><th>Tác giả</th><th>Hành động</th>
    </tr>
  </thead>
  <tbody>
    {% for b in books %}
    <tr>
      <td>{{ b.id }}</td>
      <td>{{ b.book_code or '-' }}</td>
      <td>{{ b.title }}</td>
      <td>{{ b.author }}</td>
      <td>
        <a href="{{ url_for('admin_books_edit', book_id=b.id) }}" style="background: #10b981; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; margin-right: 8px; display: inline-block; width: 70px; text-align: center; box-sizing: border-box;">Sửa</a>
        <form method="post" action="{{ url_for('admin_books_delete', book_id=b.id) }}" onsubmit="return confirm('Xoá sách này?')" style="display:inline-block;">
          <button type="submit" style="background: #ef4444; color: white; padding: 8px 16px; border-radius: 6px; border: none; font-weight: 600; cursor: pointer; width: 70px; text-align: center; box-sizing: border-box;">Xoá</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Hướng dẫn quản trị -->
<div class="admin-guide" style="background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin: 32px 0;">
  <h3 style="color: var(--text); margin: 0 0 16px 0; font-size: 20px;">📚 Hướng dẫn quản trị sách</h3>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
    <div>
      <h4 style="color: var(--primary); margin: 0 0 8px 0;">➕ Thêm sách mới</h4>
      <p style="color: var(--muted); margin: 0; font-size: 14px; line-height: 1.5;">
        Sử dụng nút "Thêm sách" để thêm sách mới vào hệ thống. Đảm bảo điền đầy đủ thông tin tiêu đề, tác giả, thể loại và mô tả.
      </p>
    </div>
    <div>
      <h4 style="color: var(--accent); margin: 0 0 8px 0;">🏷️ Quản lý mã sách</h4>
      <p style="color: var(--muted); margin: 0; font-size: 14px; line-height: 1.5;">
        Mỗi sách cần có mã định danh duy nhất. Sử dụng "Tự sinh mã sách mất" để tạo mã cho các sách chưa có.
      </p>
    </div>
    <div>
      <h4 style="color: #fbbf24; margin: 0 0 8px 0;">📊 Thống kê</h4>
      <p style="color: var(--muted); margin: 0; font-size: 14px; line-height: 1.5;">
        Theo dõi số lượng sách, thể loại và tình trạng mã sách để đảm bảo hệ thống hoạt động tốt.
      </p>
    </div>
    <div>
      <h4 style="color: #ef4444; margin: 0 0 8px 0;">⚠️ Lưu ý quan trọng</h4>
      <p style="color: var(--muted); margin: 0; font-size: 14px; line-height: 1.5;">
        Luôn kiểm tra thông tin sách trước khi thêm. Xóa sách sẽ không thể hoàn tác.
      </p>
    </div>
  </div>
</div>

<!-- Thể loại phổ biến -->
<div class="popular-genres" style="background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin: 32px 0;">
  <h3 style="color: var(--text); margin: 0 0 16px 0; font-size: 20px;">📖 Thể loại sách phổ biến</h3>
  <div style="display: flex; flex-wrap: wrap; gap: 12px;">
    <span style="background: var(--primary); color: #06210e; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 500;">Tiểu thuyết</span>
    <span style="background: var(--accent); color: #05202a; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 500;">Kinh tế</span>
    <span style="background: #fbbf24; color: #451a03; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 500;">Khoa học</span>
    <span style="background: #8b5cf6; color: #ffffff; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 500;">Tâm lý</span>
    <span style="background: #06b6d4; color: #ffffff; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 500;">Văn học</span>
    <span style="background: #10b981; color: #ffffff; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 500;">Thiếu nhi</span>
    <span style="background: #f59e0b; color: #ffffff; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 500;">Lịch sử</span>
    <span style="background: #ef4444; color: #ffffff; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: 500;">Truyện ngắn</span>
  </div>
</div>

<!-- Liên kết nhanh -->
<div class="quick-links" style="background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin: 32px 0;">
  <h3 style="color: var(--text); margin: 0 0 20px 0; font-size: 20px; font-weight: 700;">🔗 Liên kết nhanh</h3>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
    <div style="background: white; border: 1px solid var(--border); border-radius: 12px; padding: 16px; text-align: center;">
      <h4 style="color: var(--primary); margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">📝 Duyệt đánh giá</h4>
      <p style="color: var(--muted); margin: 0 0 12px 0; font-size: 14px;">Kiểm tra và phê duyệt đánh giá từ người dùng</p>
      <a href="{{ url_for('admin_reviews_queue') }}" class="btn" style="background: var(--primary); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">Truy cập</a>
    </div>
    <div style="background: white; border: 1px solid var(--border); border-radius: 12px; padding: 16px; text-align: center;">
      <h4 style="color: var(--accent); margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">📚 Xem tất cả sách</h4>
      <p style="color: var(--muted); margin: 0 0 12px 0; font-size: 14px;">Duyệt qua toàn bộ thư viện sách</p>
      <a href="{{ url_for('books_list') }}" class="btn" style="background: var(--accent); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">Truy cập</a>
    </div>
    <div style="background: white; border: 1px solid var(--border); border-radius: 12px; padding: 16px; text-align: center;">
      <h4 style="color: #10b981; margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">🏠 Trang chủ</h4>
      <p style="color: var(--muted); margin: 0 0 12px 0; font-size: 14px;">Quay về trang chủ của hệ thống</p>
      <a href="{{ url_for('home') }}" class="btn" style="background: #10b981; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">Truy cập</a>
    </div>
    <div style="background: white; border: 1px solid var(--border); border-radius: 12px; padding: 16px; text-align: center;">
      <h4 style="color: #8b5cf6; margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">👤 Hồ sơ cá nhân</h4>
      <p style="color: var(--muted); margin: 0 0 12px 0; font-size: 14px;">Xem và chỉnh sửa thông tin cá nhân</p>
      <a href="{{ url_for('profile') }}" class="btn" style="background: #8b5cf6; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">Truy cập</a>
    </div>
  </div>
</div>
{% endblock %}

