{% extends 'base.html' %}
{% block title %}Duyệt đánh giá{% endblock %}
{% block content %}
<div class="admin-header">
  <h2>Hàng chờ duyệt review</h2>
  <p class="muted">Chỉ dành cho admin</p>
  <p><a class="btn secondary" href="{{ url_for('admin_books') }}">← Quản trị sách</a></p>
</div>

<!-- Thống kê review -->
<div class="review-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 24px 0;">
  <div class="stat-card" style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center;">
    <div style="font-size: 32px; font-weight: 800; color: #fbbf24; margin-bottom: 8px;">{{ pending|length }}</div>
    <div style="color: var(--muted); font-size: 14px;">Review chờ duyệt</div>
  </div>
  <div class="stat-card" style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center;">
    <div style="font-size: 32px; font-weight: 800; color: var(--primary); margin-bottom: 8px;">{{ pending|selectattr('rating', 'equalto', 5)|list|length }}</div>
    <div style="color: var(--muted); font-size: 14px;">Đánh giá 5 sao</div>
  </div>
  <div class="stat-card" style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center;">
    <div style="font-size: 32px; font-weight: 800; color: var(--accent); margin-bottom: 8px;">{{ pending|selectattr('rating', 'ge', 4)|list|length }}</div>
    <div style="color: var(--muted); font-size: 14px;">Đánh giá tích cực</div>
  </div>
  <div class="stat-card" style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center;">
    <div style="font-size: 32px; font-weight: 800; color: #ef4444; margin-bottom: 8px;">{{ pending|selectattr('rating', 'lt', 3)|list|length }}</div>
    <div style="color: var(--muted); font-size: 14px;">Đánh giá tiêu cực</div>
  </div>
</div>
<table class="table">
  <thead>
    <tr>
      <th>ID</th><th>Sách</th><th>Người gửi</th><th>Điểm</th><th>Thời gian</th><th></th>
    </tr>
  </thead>
  <tbody>
    {% for r in pending %}
    <tr>
      <td>{{ r.id }}</td>
      <td><a href="{{ url_for('book_detail', book_id=r.book_id) }}" target="_blank">{{ r.book_title }}</a></td>
      <td>{{ r.reviewer }}</td>
      <td>{{ r.rating }}</td>
      <td>{{ r.created_at }}</td>
      <td style="text-align:right;display:flex;gap:8px;justify-content:flex-end">
        <a class="btn secondary" href="{{ url_for('admin_review_edit', review_id=r.id) }}">Sửa chi tiết</a>
        <form method="post" action="{{ url_for('admin_review_approve', review_id=r.id) }}">
          <button class="btn" type="submit">Duyệt</button>
        </form>
        <form method="post" action="{{ url_for('admin_review_reject', review_id=r.id) }}">
          <input name="reason" placeholder="Lý do từ chối" style="background:var(--panel);border:1px solid var(--border);border-radius:8px;padding:8px">
          <button class="btn secondary" type="submit">Từ chối</button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr><td colspan="6"><p class="muted">Không có review chờ duyệt.</p></td></tr>
    {% endfor %}
  </tbody>
</table>

<!-- Hướng dẫn duyệt review -->
<div class="review-guide" style="background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin: 32px 0;">
  <h3 style="color: var(--text); margin: 0 0 16px 0; font-size: 20px;">📝 Hướng dẫn duyệt đánh giá</h3>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
    <div>
      <h4 style="color: var(--primary); margin: 0 0 8px 0;">✅ Tiêu chí duyệt</h4>
      <ul style="color: var(--muted); margin: 0; font-size: 14px; line-height: 1.6; padding-left: 20px;">
        <li>Nội dung có ý nghĩa và hữu ích</li>
        <li>Không chứa spam hoặc quảng cáo</li>
        <li>Ngôn ngữ lịch sự, không xúc phạm</li>
        <li>Liên quan đến nội dung sách</li>
      </ul>
    </div>
    <div>
      <h4 style="color: var(--accent); margin: 0 0 8px 0;">❌ Lý do từ chối</h4>
      <ul style="color: var(--muted); margin: 0; font-size: 14px; line-height: 1.6; padding-left: 20px;">
        <li>Nội dung không phù hợp</li>
        <li>Spam hoặc quảng cáo</li>
        <li>Ngôn ngữ thô tục</li>
        <li>Không liên quan đến sách</li>
      </ul>
    </div>
    <div>
      <h4 style="color: #fbbf24; margin: 0 0 8px 0;">⭐ Đánh giá chất lượng</h4>
      <ul style="color: var(--muted); margin: 0; font-size: 14px; line-height: 1.6; padding-left: 20px;">
        <li>5 sao: Xuất sắc, đáng đọc</li>
        <li>4 sao: Tốt, có giá trị</li>
        <li>3 sao: Bình thường</li>
        <li>2 sao: Kém, không nên đọc</li>
        <li>1 sao: Rất kém</li>
      </ul>
    </div>
    <div>
      <h4 style="color: #ef4444; margin: 0 0 8px 0;">⚠️ Lưu ý quan trọng</h4>
      <p style="color: var(--muted); margin: 0; font-size: 14px; line-height: 1.5;">
        Luôn đọc kỹ nội dung review trước khi duyệt. Từ chối review cần có lý do rõ ràng để người dùng hiểu.
      </p>
    </div>
  </div>
</div>

<!-- Thống kê đánh giá theo thời gian -->
<div class="review-timeline" style="background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin: 32px 0;">
  <h3 style="color: var(--text); margin: 0 0 16px 0; font-size: 20px;">📊 Thống kê đánh giá</h3>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
    <div style="text-align: center; padding: 16px; background: color-mix(in oklab, var(--primary) 10%, transparent); border-radius: 12px;">
      <div style="font-size: 24px; font-weight: 700; color: var(--primary);">⭐</div>
      <div style="color: var(--muted); font-size: 12px; margin-top: 4px;">Đánh giá cao</div>
    </div>
    <div style="text-align: center; padding: 16px; background: color-mix(in oklab, var(--accent) 10%, transparent); border-radius: 12px;">
      <div style="font-size: 24px; font-weight: 700; color: var(--accent);">📝</div>
      <div style="color: var(--muted); font-size: 12px; margin-top: 4px;">Review chi tiết</div>
    </div>
    <div style="text-align: center; padding: 16px; background: color-mix(in oklab, #fbbf24 10%, transparent); border-radius: 12px;">
      <div style="font-size: 24px; font-weight: 700; color: #fbbf24;">⏰</div>
      <div style="color: var(--muted); font-size: 12px; margin-top: 4px;">Gần đây</div>
    </div>
    <div style="text-align: center; padding: 16px; background: color-mix(in oklab, #ef4444 10%, transparent); border-radius: 12px;">
      <div style="font-size: 24px; font-weight: 700; color: #ef4444;">🚫</div>
      <div style="color: var(--muted); font-size: 12px; margin-top: 4px;">Cần xem xét</div>
    </div>
  </div>
</div>

<!-- Liên kết nhanh -->
<div class="quick-links" style="background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin: 32px 0;">
  <h3 style="color: var(--text); margin: 0 0 20px 0; font-size: 20px; font-weight: 700;">🔗 Liên kết nhanh</h3>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
    <div style="background: white; border: 1px solid var(--border); border-radius: 12px; padding: 16px; text-align: center;">
      <h4 style="color: var(--primary); margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">📚 Quản trị sách</h4>
      <p style="color: var(--muted); margin: 0 0 12px 0; font-size: 14px;">Quản lý và chỉnh sửa thông tin sách</p>
      <a href="{{ url_for('admin_books') }}" class="btn" style="background: var(--primary); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">Truy cập</a>
    </div>
    <div style="background: white; border: 1px solid var(--border); border-radius: 12px; padding: 16px; text-align: center;">
      <h4 style="color: var(--accent); margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">📖 Xem tất cả sách</h4>
      <p style="color: var(--muted); margin: 0 0 12px 0; font-size: 14px;">Duyệt qua toàn bộ thư viện sách</p>
      <a href="{{ url_for('books_list') }}" class="btn" style="background: var(--accent); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">Truy cập</a>
    </div>
    <div style="background: white; border: 1px solid var(--border); border-radius: 12px; padding: 16px; text-align: center;">
      <h4 style="color: #10b981; margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">🏠 Trang chủ</h4>
      <p style="color: var(--muted); margin: 0 0 12px 0; font-size: 14px;">Quay về trang chủ của hệ thống</p>
      <a href="{{ url_for('home') }}" class="btn" style="background: #10b981; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">Truy cập</a>
    </div>
    <div style="background: white; border: 1px solid var(--border); border-radius: 12px; padding: 16px; text-align: center;">
      <h4 style="color: #8b5cf6; margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">👤 Hồ sơ cá nhân</h4>
      <p style="color: var(--muted); margin: 0 0 12px 0; font-size: 14px;">Xem và chỉnh sửa thông tin cá nhân</p>
      <a href="{{ url_for('profile') }}" class="btn" style="background: #8b5cf6; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">Truy cập</a>
    </div>
  </div>
</div>
{% endblock %}


