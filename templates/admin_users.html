{% extends 'base.html' %}
{% block title %}Quáº£n lÃ½ tÃ i khoáº£n{% endblock %}
{% block content %}
<div class="admin-header">
  <h2>Quáº£n lÃ½ tÃ i khoáº£n</h2>
  <p class="muted">Danh sÃ¡ch táº¥t cáº£ tÃ i khoáº£n Ä‘Ã£ Ä‘Äƒng kÃ½</p>
</div>

<!-- Thá»‘ng kÃª tá»•ng quan -->
<div class="admin-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 24px 0;">
  <div class="stat-card" style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center;">
    <div style="font-size: 32px; font-weight: 800; color: var(--primary); margin-bottom: 8px;">{{ total_users }}</div>
    <div style="color: var(--muted); font-size: 14px;">Tá»•ng sá»‘ tÃ i khoáº£n</div>
  </div>
  <div class="stat-card" style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center;">
    <div style="font-size: 32px; font-weight: 800; color: var(--accent); margin-bottom: 8px;">{{ admin_count }}</div>
    <div style="color: var(--muted); font-size: 14px;">TÃ i khoáº£n Admin</div>
  </div>
  <div class="stat-card" style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center;">
    <div style="font-size: 32px; font-weight: 800; color: #fbbf24; margin-bottom: 8px;">{{ user_count }}</div>
    <div style="color: var(--muted); font-size: 14px;">TÃ i khoáº£n User</div>
  </div>
  <div class="stat-card" style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center;">
    <div style="font-size: 32px; font-weight: 800; color: #10b981; margin-bottom: 8px;">{{ users|length }}</div>
    <div style="color: var(--muted); font-size: 14px;">Káº¿t quáº£ hiá»ƒn thá»‹</div>
  </div>
</div>

<!-- Bá»™ lá»c vÃ  tÃ¬m kiáº¿m -->
<div class="admin-filters" style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin: 24px 0;">
  <form method="get" action="{{ url_for('admin_users') }}" style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
    <div style="display: flex; align-items: center; gap: 8px;">
      <label style="font-weight: 500; color: var(--text);">TÃ¬m kiáº¿m:</label>
      <input type="text" name="q" placeholder="TÃªn Ä‘Äƒng nháº­p..." value="{{ q }}" style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); color: var(--text);">
    </div>
    <div style="display: flex; align-items: center; gap: 8px;">
      <label style="font-weight: 500; color: var(--text);">Vai trÃ²:</label>
      <select name="role" style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg); color: var(--text);">
        <option value="">Táº¥t cáº£</option>
        <option value="admin" {{ 'selected' if role_filter == 'admin' else '' }}>Admin</option>
        <option value="user" {{ 'selected' if role_filter == 'user' else '' }}>User</option>
      </select>
    </div>
    <button type="submit" class="btn" style="padding: 8px 16px;">TÃ¬m kiáº¿m</button>
    <a href="{{ url_for('admin_users') }}" class="btn secondary" style="padding: 8px 16px; text-decoration: none;">XÃ³a bá»™ lá»c</a>
  </form>
</div>

<!-- Sáº¯p xáº¿p -->
<div style="margin: 16px 0; display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
  <span class="muted">Sáº¯p xáº¿p:</span>
  <a class="btn secondary" href="{{ url_for('admin_users', q=q, role=role_filter, sort='username_asc') }}">A â†’ Z (TÃªn)</a>
  <a class="btn secondary" href="{{ url_for('admin_users', q=q, role=role_filter, sort='username_desc') }}">Z â†’ A (TÃªn)</a>
  <a class="btn secondary" href="{{ url_for('admin_users', q=q, role=role_filter, sort='id_asc') }}">ID â†‘</a>
  <a class="btn secondary" href="{{ url_for('admin_users', q=q, role=role_filter, sort='id_desc') }}">ID â†“</a>
  <a class="btn secondary" href="{{ url_for('admin_users', q=q, role=role_filter, sort='role_asc') }}">Vai trÃ² â†‘</a>
  <a class="btn secondary" href="{{ url_for('admin_users', q=q, role=role_filter, sort='role_desc') }}">Vai trÃ² â†“</a>
  <a class="btn secondary" href="{{ url_for('admin_users', q=q, role=role_filter, sort='created_desc') }}">Má»›i nháº¥t</a>
</div>

<!-- Báº£ng danh sÃ¡ch tÃ i khoáº£n -->
<div class="table-container" style="background: var(--panel); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; margin: 24px 0;">
  <table class="table" style="margin: 0;">
    <thead style="background: var(--bg-secondary);">
      <tr>
        <th style="padding: 16px; border-bottom: 1px solid var(--border);">ID</th>
        <th style="padding: 16px; border-bottom: 1px solid var(--border);">TÃªn Ä‘Äƒng nháº­p</th>
        <th style="padding: 16px; border-bottom: 1px solid var(--border);">Máº­t kháº©u (Hash)</th>
        <th style="padding: 16px; border-bottom: 1px solid var(--border);">Vai trÃ²</th>
        <th style="padding: 16px; border-bottom: 1px solid var(--border);">NgÃ y táº¡o</th>
        <th style="padding: 16px; border-bottom: 1px solid var(--border); text-align: center;">Thao tÃ¡c</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr style="border-bottom: 1px solid var(--border);">
        <td style="padding: 16px; font-weight: 600; color: var(--primary);">{{ user.id }}</td>
        <td style="padding: 16px;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
              {{ user.username[0].upper() }}
            </div>
            <span style="font-weight: 500;">{{ user.username }}</span>
          </div>
        </td>
        <td style="padding: 16px;">
          <div style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-family: monospace; font-size: 12px; color: var(--muted); background: var(--bg-secondary); padding: 4px 8px; border-radius: 4px;" title="{{ user.password_hash }}">
            {{ user.password_hash[:50] }}{{ '...' if user.password_hash|length > 50 else '' }}
          </div>
        </td>
        <td style="padding: 16px;">
          {% if user.role == 'admin' %}
            <span style="background: #ef4444; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">ADMIN</span>
          {% else %}
            <span style="background: var(--accent); color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">USER</span>
          {% endif %}
        </td>
        <td style="padding: 16px; color: var(--muted); font-size: 14px;">
          {{ user.created_at.split(' ')[0] if user.created_at else 'N/A' }}
        </td>
        <td style="padding: 16px; text-align: center;">
          {% if user.role != 'admin' %}
            <form method="post" action="{{ url_for('admin_users_delete', user_id=user.id) }}" onsubmit="return confirm('Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a tÃ i khoáº£n {{ user.username }}? HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c.')" style="display: inline;">
              <button class="btn secondary" type="submit" style="background: #ef4444; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">
                XÃ³a
              </button>
            </form>
          {% else %}
            <span style="color: var(--muted); font-size: 12px;">KhÃ´ng thá»ƒ xÃ³a</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- HÆ°á»›ng dáº«n quáº£n lÃ½ tÃ i khoáº£n -->
<div class="admin-guide" style="background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin: 32px 0;">
  <h3 style="color: var(--text); margin: 0 0 16px 0; font-size: 20px;">ğŸ‘¥ HÆ°á»›ng dáº«n quáº£n lÃ½ tÃ i khoáº£n</h3>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
    <div>
      <h4 style="color: var(--primary); margin: 0 0 8px 0;">ğŸ” Xem thÃ´ng tin tÃ i khoáº£n</h4>
      <p style="color: var(--muted); margin: 0; font-size: 14px; line-height: 1.5;">
        Báº£ng trÃªn hiá»ƒn thá»‹ táº¥t cáº£ tÃ i khoáº£n Ä‘Ã£ Ä‘Äƒng kÃ½ trong há»‡ thá»‘ng, bao gá»“m ID, tÃªn Ä‘Äƒng nháº­p, vai trÃ² vÃ  ngÃ y táº¡o.
      </p>
    </div>
    <div>
      <h4 style="color: var(--accent); margin: 0 0 8px 0;">ğŸ›¡ï¸ Báº£o máº­t tÃ i khoáº£n</h4>
      <p style="color: var(--muted); margin: 0; font-size: 14px; line-height: 1.5;">
        TÃ i khoáº£n admin Ä‘Æ°á»£c báº£o vá»‡ vÃ  khÃ´ng thá»ƒ xÃ³a. Chá»‰ cÃ³ thá»ƒ xÃ³a cÃ¡c tÃ i khoáº£n user thÃ´ng thÆ°á»ng.
      </p>
    </div>
    <div>
      <h4 style="color: #fbbf24; margin: 0 0 8px 0;">ğŸ“Š Thá»‘ng kÃª</h4>
      <p style="color: var(--muted); margin: 0; font-size: 14px; line-height: 1.5;">
        Theo dÃµi sá»‘ lÆ°á»£ng tÃ i khoáº£n admin, user vÃ  tá»•ng sá»‘ tÃ i khoáº£n Ä‘á»ƒ quáº£n lÃ½ há»‡ thá»‘ng hiá»‡u quáº£.
      </p>
    </div>
    <div>
      <h4 style="color: #ef4444; margin: 0 0 8px 0;">âš ï¸ LÆ°u Ã½ quan trá»ng</h4>
      <p style="color: var(--muted); margin: 0; font-size: 14px; line-height: 1.5;">
        Viá»‡c xÃ³a tÃ i khoáº£n sáº½ xÃ³a táº¥t cáº£ dá»¯ liá»‡u liÃªn quan (bookmarks, votes, reports). HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c.
      </p>
    </div>
  </div>
</div>

<!-- LiÃªn káº¿t nhanh -->
<div class="quick-links" style="background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin: 32px 0;">
  <h3 style="color: var(--text); margin: 0 0 20px 0; font-size: 20px; font-weight: 700;">ğŸ”— LiÃªn káº¿t nhanh</h3>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
    <div style="background: white; border: 1px solid var(--border); border-radius: 12px; padding: 16px; text-align: center;">
      <h4 style="color: var(--primary); margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">ğŸ“š Quáº£n trá»‹ sÃ¡ch</h4>
      <p style="color: var(--muted); margin: 0 0 12px 0; font-size: 14px;">Quáº£n lÃ½ vÃ  chá»‰nh sá»­a thÃ´ng tin sÃ¡ch</p>
      <a href="{{ url_for('admin_books') }}" class="btn" style="background: var(--primary); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">Truy cáº­p</a>
    </div>
    <div style="background: white; border: 1px solid var(--border); border-radius: 12px; padding: 16px; text-align: center;">
      <h4 style="color: var(--accent); margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">ğŸ“ Duyá»‡t Ä‘Ã¡nh giÃ¡</h4>
      <p style="color: var(--muted); margin: 0 0 12px 0; font-size: 14px;">Kiá»ƒm tra vÃ  phÃª duyá»‡t Ä‘Ã¡nh giÃ¡ tá»« ngÆ°á»i dÃ¹ng</p>
      <a href="{{ url_for('admin_reviews_queue') }}" class="btn" style="background: var(--accent); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">Truy cáº­p</a>
    </div>
    <div style="background: white; border: 1px solid var(--border); border-radius: 12px; padding: 16px; text-align: center;">
      <h4 style="color: #10b981; margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">ğŸ  Trang chá»§</h4>
      <p style="color: var(--muted); margin: 0 0 12px 0; font-size: 14px;">Quay vá» trang chá»§ cá»§a há»‡ thá»‘ng</p>
      <a href="{{ url_for('home') }}" class="btn" style="background: #10b981; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">Truy cáº­p</a>
    </div>
    <div style="background: white; border: 1px solid var(--border); border-radius: 12px; padding: 16px; text-align: center;">
      <h4 style="color: #8b5cf6; margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">ğŸ‘¤ Há»“ sÆ¡ cÃ¡ nhÃ¢n</h4>
      <p style="color: var(--muted); margin: 0 0 12px 0; font-size: 14px;">Xem vÃ  chá»‰nh sá»­a thÃ´ng tin cÃ¡ nhÃ¢n</p>
      <a href="{{ url_for('profile') }}" class="btn" style="background: #8b5cf6; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">Truy cáº­p</a>
    </div>
  </div>
</div>
{% endblock %}
