{% extends 'base.html' %}
{% block title %}{% if is_edit %}Sá»­a sÃ¡ch{% else %}ThÃªm sÃ¡ch{% endif %}{% endblock %}
{% block content %}
<div class="page-header">
  <h1 class="page-title">{% if is_edit %}ğŸ“ Sá»­a sÃ¡ch{% else %}â• ThÃªm sÃ¡ch má»›i{% endif %}</h1>
  <p class="page-subtitle">{% if is_edit %}Chá»‰nh sá»­a thÃ´ng tin chi tiáº¿t cá»§a sÃ¡ch{% else %}ThÃªm sÃ¡ch má»›i vÃ o thÆ° viá»‡n{% endif %}</p>
</div>

<div class="form-container" style="background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 32px; margin: 24px 0; box-shadow: var(--shadow);">
  <form method="post" class="form">
  <!-- ThÃ´ng tin cÆ¡ báº£n -->
  <div class="form-section" style="margin-bottom: 32px;">
    <h3 style="color: var(--text); margin: 0 0 20px 0; font-size: 18px; border-bottom: 2px solid var(--primary); padding-bottom: 8px;">ğŸ“š ThÃ´ng tin cÆ¡ báº£n</h3>
    
    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 20px;">
      <label style="display: flex; flex-direction: column; gap: 8px;">
        <span style="font-weight: 600; color: var(--text);">MÃ£ sÃ¡ch <span style="color: #ef4444;">*</span></span>
        <input name="book_code" required placeholder="VD: BK1001" value="{{ (book.book_code if book else '') }}" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
        <small style="color: var(--muted); font-size: 12px;">MÃ£ Ä‘á»‹nh danh duy nháº¥t cho sÃ¡ch</small>
      </label>
      <label style="display: flex; flex-direction: column; gap: 8px;">
        <span style="font-weight: 600; color: var(--text);">TiÃªu Ä‘á» sÃ¡ch <span style="color: #ef4444;">*</span></span>
        <input name="title" required value="{{ (book.title if book else '') }}" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
        <small style="color: var(--muted); font-size: 12px;">TÃªn Ä‘áº§y Ä‘á»§ cá»§a cuá»‘n sÃ¡ch</small>
      </label>
    </div>
    
    <label style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;">
      <span style="font-weight: 600; color: var(--text);">TÃ¡c giáº£ <span style="color: #ef4444;">*</span></span>
      <input name="author" required value="{{ (book.author if book else '') }}" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
      <small style="color: var(--muted); font-size: 12px;">TÃªn tÃ¡c giáº£ hoáº·c nhÃ³m tÃ¡c giáº£</small>
    </label>
  </div>
{% if adding_disabled and not is_edit %}
  <div class="alert" style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 16px; margin: 20px 0;">
    <p style="color: #92400e; margin: 0;">âš ï¸ Chá»©c nÄƒng thÃªm sÃ¡ch táº¡m thá»i bá»‹ vÃ´ hiá»‡u hÃ³a. Vui lÃ²ng kiá»ƒm tra láº¡i cáº¥u hÃ¬nh database.</p>
  </div>
  <div class="actions">
    <a class="btn secondary" href="{{ url_for('admin_books') }}">â† Quay láº¡i</a>
  </div>
{% else %}
  <!-- ThÃ´ng tin chi tiáº¿t -->
  <div class="form-section" style="margin-bottom: 32px;">
    <h3 style="color: var(--text); margin: 0 0 20px 0; font-size: 18px; border-bottom: 2px solid var(--accent); padding-bottom: 8px;">ğŸ–¼ï¸ HÃ¬nh áº£nh & PhÃ¢n loáº¡i</h3>
    
    <label style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;">
      <span style="font-weight: 600; color: var(--text);">áº¢nh bÃ¬a sÃ¡ch</span>
      <input name="cover_url" placeholder="https://example.com/book-cover.jpg" value="{{ (book.cover_url if book else '') }}" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
      <small style="color: var(--muted); font-size: 12px;">URL hÃ¬nh áº£nh bÃ¬a sÃ¡ch (khuyáº¿n nghá»‹ tá»· lá»‡ 3:4)</small>
    </label>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
      <label style="display: flex; flex-direction: column; gap: 8px;">
        <span style="font-weight: 600; color: var(--text);">Danh má»¥c</span>
        <select name="category_id" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
          <option value="">-- Chá»n danh má»¥c --</option>
          {% set cur_cat = (book.category_id if book else None) %}
          {% for c in (categories or []) %}
            <option value="{{ c.id }}" {% if cur_cat==c.id %}selected{% endif %}>{{ c.name }}</option>
          {% endfor %}
        </select>
        <small style="color: var(--muted); font-size: 12px;">PhÃ¢n loáº¡i chÃ­nh cá»§a sÃ¡ch</small>
      </label>
      
      <label style="display: flex; flex-direction: column; gap: 8px;">
        <span style="font-weight: 600; color: var(--text);">Thá»ƒ loáº¡i</span>
        <select name="genre" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
          {% set gval = book.genre if book else '' %}
          <option value="" {% if not gval %}selected{% endif %}>-- Chá»n thá»ƒ loáº¡i --</option>
          {% for opt in ['Tiá»ƒu thuyáº¿t','Truyá»‡n ngáº¯n','Kinh táº¿','VÄƒn há»c','Khoa há»c','TÃ¢m lÃ½','Thiáº¿u nhi','Lá»‹ch sá»­','KhÃ¡c'] %}
            <option value="{{ opt }}" {% if gval==opt %}selected{% endif %}>{{ opt }}</option>
          {% endfor %}
        </select>
        <small style="color: var(--muted); font-size: 12px;">Thá»ƒ loáº¡i phá»¥ cá»§a sÃ¡ch</small>
      </label>
    </div>
    
    <label style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;">
      <span style="font-weight: 600; color: var(--text);">Tags</span>
      <input name="tags" placeholder="VD: cá»• Ä‘iá»ƒn, chÃ¢m biáº¿m, bestseller" value="{{ (tags if tags else '') }}" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
      <small style="color: var(--muted); font-size: 12px;">Tá»« khÃ³a phÃ¢n tÃ¡ch bá»Ÿi dáº¥u pháº©y Ä‘á»ƒ tÃ¬m kiáº¿m dá»… dÃ ng</small>
    </label>
  </div>
  
  <!-- ThÃ´ng tin xuáº¥t báº£n -->
  <div class="form-section" style="margin-bottom: 32px;">
    <h3 style="color: var(--text); margin: 0 0 20px 0; font-size: 18px; border-bottom: 2px solid #fbbf24; padding-bottom: 8px;">ğŸ“– ThÃ´ng tin xuáº¥t báº£n</h3>
    
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px;">
      <label style="display: flex; flex-direction: column; gap: 8px;">
        <span style="font-weight: 600; color: var(--text);">NhÃ  xuáº¥t báº£n</span>
        <input name="publisher" placeholder="VD: NXB Tráº», NhÃ£ Nam, Alpha Books" value="{{ (book.publisher if book else '') }}" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
        <small style="color: var(--muted); font-size: 12px;">TÃªn nhÃ  xuáº¥t báº£n</small>
      </label>
      
      <label style="display: flex; flex-direction: column; gap: 8px;">
        <span style="font-weight: 600; color: var(--text);">Sá»‘ trang</span>
        <input name="num_pages" type="number" min="1" step="1" placeholder="320" value="{{ (book.num_pages if book and book.num_pages is not none else '') }}" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
        <small style="color: var(--muted); font-size: 12px;">Tá»•ng sá»‘ trang</small>
      </label>
    </div>
  </div>
  
  <!-- MÃ´ táº£ -->
  <div class="form-section" style="margin-bottom: 32px;">
    <h3 style="color: var(--text); margin: 0 0 20px 0; font-size: 18px; border-bottom: 2px solid #8b5cf6; padding-bottom: 8px;">ğŸ“ MÃ´ táº£ sÃ¡ch</h3>
    
    <label style="display: flex; flex-direction: column; gap: 8px;">
      <span style="font-weight: 600; color: var(--text);">TÃ³m táº¯t ná»™i dung</span>
      <textarea name="description" rows="6" placeholder="Nháº­p mÃ´ táº£ chi tiáº¿t vá» ná»™i dung, chá»§ Ä‘á» vÃ  giÃ¡ trá»‹ cá»§a cuá»‘n sÃ¡ch..." style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text); resize: vertical;">{{ (book.description if book else '') }}</textarea>
      <small style="color: var(--muted); font-size: 12px;">MÃ´ táº£ chi tiáº¿t vá» ná»™i dung vÃ  giÃ¡ trá»‹ cá»§a sÃ¡ch (khuyáº¿n nghá»‹ 200-500 tá»«)</small>
    </label>

    {% if is_edit and book %}
    <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap">
      <form method="post" action="{{ url_for('admin_enhance_book_description', book_id=book.id) }}" onsubmit="return confirm('Táº¡o mÃ´ táº£ dÃ i vÃ  háº¥p dáº«n hÆ¡n cho sÃ¡ch nÃ y?')">
        <button class="btn secondary" type="submit">Viáº¿t mÃ´ táº£ dÃ i hÆ¡n</button>
      </form>
      <form method="post" action="{{ url_for('admin_generate_review_for_book', book_id=book.id) }}" onsubmit="return confirm('Táº¡o review biÃªn táº­p cho sÃ¡ch nÃ y?')">
        <button class="btn secondary" type="submit">Táº¡o review biÃªn táº­p</button>
      </form>
    </div>
    {% endif %}
  </div>
  <!-- Actions -->
  <div class="form-actions" style="display: flex; gap: 12px; justify-content: flex-end; padding-top: 24px; border-top: 1px solid var(--border);">
    <a class="btn secondary" href="{{ url_for('admin_books') }}" style="text-decoration: none;">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      <span>Há»§y bá»</span>
    </a>
    <button class="btn" type="submit" style="display: flex; align-items: center; gap: 8px;">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
        <polyline points="17,21 17,13 7,13 7,21"/>
        <polyline points="7,3 7,8 15,8"/>
      </svg>
      <span>{% if is_edit %}Cáº­p nháº­t sÃ¡ch{% else %}LÆ°u sÃ¡ch má»›i{% endif %}</span>
    </button>
  </div>
{% endif %}
  </form>
</div>

<!-- HÆ°á»›ng dáº«n vÃ  liÃªn káº¿t -->
<div class="form-help" style="background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin: 24px 0;">
  <h3 style="color: var(--text); margin: 0 0 16px 0; font-size: 18px;">ğŸ’¡ HÆ°á»›ng dáº«n sá»­ dá»¥ng</h3>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
    <div>
      <h4 style="color: var(--primary); margin: 0 0 8px 0; font-size: 14px;">ğŸ“‹ ThÃ´ng tin báº¯t buá»™c</h4>
      <ul style="color: var(--muted); margin: 0; font-size: 13px; line-height: 1.5; padding-left: 16px;">
        <li>MÃ£ sÃ¡ch: Äá»‹nh danh duy nháº¥t</li>
        <li>TiÃªu Ä‘á»: TÃªn Ä‘áº§y Ä‘á»§ cá»§a sÃ¡ch</li>
        <li>TÃ¡c giáº£: TÃªn tÃ¡c giáº£ chÃ­nh</li>
      </ul>
    </div>
    <div>
      <h4 style="color: var(--accent); margin: 0 0 8px 0; font-size: 14px;">ğŸ·ï¸ PhÃ¢n loáº¡i</h4>
      <ul style="color: var(--muted); margin: 0; font-size: 13px; line-height: 1.5; padding-left: 16px;">
        <li>Danh má»¥c: PhÃ¢n loáº¡i chÃ­nh</li>
        <li>Thá»ƒ loáº¡i: PhÃ¢n loáº¡i phá»¥</li>
        <li>Tags: Tá»« khÃ³a tÃ¬m kiáº¿m</li>
      </ul>
    </div>
    <div>
      <h4 style="color: #fbbf24; margin: 0 0 8px 0; font-size: 14px;">ğŸ”— Quáº£n lÃ½</h4>
      <div style="display: flex; gap: 12px; flex-wrap: wrap;">
        <a href="{{ url_for('admin_categories') }}" class="btn secondary" style="text-decoration: none; font-size: 12px; padding: 6px 12px;">ğŸ“‚ Danh má»¥c</a>
        <a href="{{ url_for('admin_tags') }}" class="btn secondary" style="text-decoration: none; font-size: 12px; padding: 6px 12px;">ğŸ·ï¸ Tags</a>
        <a href="{{ url_for('admin_books') }}" class="btn secondary" style="text-decoration: none; font-size: 12px; padding: 6px 12px;">ğŸ“š Danh sÃ¡ch</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

