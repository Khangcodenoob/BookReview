{% extends 'base.html' %}
{% block title %}{% if is_edit %}S·ª≠a s√°ch{% else %}Th√™m s√°ch{% endif %}{% endblock %}
{% block content %}
<div class="page-header">
  <h1 class="page-title">{% if is_edit %}üìù S·ª≠a s√°ch{% else %}‚ûï Th√™m s√°ch m·ªõi{% endif %}</h1>
  <p class="page-subtitle">{% if is_edit %}Ch·ªânh s·ª≠a th√¥ng tin chi ti·∫øt c·ªßa s√°ch{% else %}Th√™m s√°ch m·ªõi v√†o th∆∞ vi·ªán{% endif %}</p>
</div>

<div class="form-container" style="background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 32px; margin: 24px 0; box-shadow: var(--shadow);">
  <form method="post" class="form">
  <!-- Th√¥ng tin c∆° b·∫£n -->
  <div class="form-section" style="margin-bottom: 32px;">
    <h3 style="color: var(--text); margin: 0 0 20px 0; font-size: 18px; border-bottom: 2px solid var(--primary); padding-bottom: 8px;">üìö Th√¥ng tin c∆° b·∫£n</h3>
    
    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 20px;">
      <label style="display: flex; flex-direction: column; gap: 8px;">
        <span style="font-weight: 600; color: var(--text);">M√£ s√°ch <span style="color: #ef4444;">*</span></span>
        <input name="book_code" required placeholder="VD: BK1001" value="{{ (book.book_code if book else '') }}" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
        <small style="color: var(--muted); font-size: 12px;">M√£ ƒë·ªãnh danh duy nh·∫•t cho s√°ch</small>
      </label>
      <label style="display: flex; flex-direction: column; gap: 8px;">
        <span style="font-weight: 600; color: var(--text);">Ti√™u ƒë·ªÅ s√°ch <span style="color: #ef4444;">*</span></span>
        <input name="title" required value="{{ (book.title if book else '') }}" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
        <small style="color: var(--muted); font-size: 12px;">T√™n ƒë·∫ßy ƒë·ªß c·ªßa cu·ªën s√°ch</small>
      </label>
    </div>
    
    <label style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;">
      <span style="font-weight: 600; color: var(--text);">T√°c gi·∫£ <span style="color: #ef4444;">*</span></span>
      <input name="author" required value="{{ (book.author if book else '') }}" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
      <small style="color: var(--muted); font-size: 12px;">T√™n t√°c gi·∫£ ho·∫∑c nh√≥m t√°c gi·∫£</small>
    </label>
  </div>
{% if adding_disabled and not is_edit %}
  <div class="alert" style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 16px; margin: 20px 0;">
    <p style="color: #92400e; margin: 0;">‚ö†Ô∏è Ch·ª©c nƒÉng th√™m s√°ch t·∫°m th·ªùi b·ªã v√¥ hi·ªáu h√≥a. Vui l√≤ng ki·ªÉm tra l·∫°i c·∫•u h√¨nh database.</p>
  </div>
  <div class="actions">
    <a class="btn secondary" href="{{ url_for('admin_books') }}">‚Üê Quay l·∫°i</a>
  </div>
{% else %}
  <!-- Th√¥ng tin chi ti·∫øt -->
  <div class="form-section" style="margin-bottom: 32px;">
    <h3 style="color: var(--text); margin: 0 0 20px 0; font-size: 18px; border-bottom: 2px solid var(--accent); padding-bottom: 8px;">üñºÔ∏è H√¨nh ·∫£nh & Ph√¢n lo·∫°i</h3>
    
    <label style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;">
      <span style="font-weight: 600; color: var(--text);">·∫¢nh b√¨a s√°ch</span>
      <input name="cover_url" placeholder="https://example.com/book-cover.jpg" value="{{ (book.cover_url if book else '') }}" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
      <small style="color: var(--muted); font-size: 12px;">URL h√¨nh ·∫£nh b√¨a s√°ch (khuy·∫øn ngh·ªã t·ª∑ l·ªá 3:4)</small>
    </label>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
      <label style="display: flex; flex-direction: column; gap: 8px;">
        <span style="font-weight: 600; color: var(--text);">Danh m·ª•c</span>
        <select name="category_id" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
          <option value="">-- Ch·ªçn danh m·ª•c --</option>
          {% set cur_cat = (book.category_id if book else None) %}
          {% for c in (categories or []) %}
            <option value="{{ c.id }}" {% if cur_cat==c.id %}selected{% endif %}>{{ c.name }}</option>
          {% endfor %}
        </select>
        <small style="color: var(--muted); font-size: 12px;">Ph√¢n lo·∫°i ch√≠nh c·ªßa s√°ch</small>
      </label>
      
      <label style="display: flex; flex-direction: column; gap: 8px;">
        <span style="font-weight: 600; color: var(--text);">Th·ªÉ lo·∫°i</span>
        <select name="genre" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
          {% set gval = book.genre if book else '' %}
          <option value="" {% if not gval %}selected{% endif %}>-- Ch·ªçn th·ªÉ lo·∫°i --</option>
          {% for opt in ['Ti·ªÉu thuy·∫øt','Truy·ªán ng·∫Øn','Kinh t·∫ø','VƒÉn h·ªçc','Khoa h·ªçc','T√¢m l√Ω','Thi·∫øu nhi','L·ªãch s·ª≠','Kh√°c'] %}
            <option value="{{ opt }}" {% if gval==opt %}selected{% endif %}>{{ opt }}</option>
          {% endfor %}
        </select>
        <small style="color: var(--muted); font-size: 12px;">Th·ªÉ lo·∫°i ph·ª• c·ªßa s√°ch</small>
      </label>
    </div>
    
    <label style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;">
      <span style="font-weight: 600; color: var(--text);">Tags</span>
      <input name="tags" placeholder="VD: c·ªï ƒëi·ªÉn, ch√¢m bi·∫øm, bestseller" value="{{ (tags if tags else '') }}" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
      <small style="color: var(--muted); font-size: 12px;">T·ª´ kh√≥a ph√¢n t√°ch b·ªüi d·∫•u ph·∫©y ƒë·ªÉ t√¨m ki·∫øm d·ªÖ d√†ng</small>
    </label>
  </div>
  
  <!-- Th√¥ng tin xu·∫•t b·∫£n -->
  <div class="form-section" style="margin-bottom: 32px;">
    <h3 style="color: var(--text); margin: 0 0 20px 0; font-size: 18px; border-bottom: 2px solid #fbbf24; padding-bottom: 8px;">üìñ Th√¥ng tin xu·∫•t b·∫£n</h3>
    
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px;">
      <label style="display: flex; flex-direction: column; gap: 8px;">
        <span style="font-weight: 600; color: var(--text);">Nh√† xu·∫•t b·∫£n</span>
        <input name="publisher" placeholder="VD: NXB Tr·∫ª, Nh√£ Nam, Alpha Books" value="{{ (book.publisher if book else '') }}" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
        <small style="color: var(--muted); font-size: 12px;">T√™n nh√† xu·∫•t b·∫£n</small>
      </label>
      
      <label style="display: flex; flex-direction: column; gap: 8px;">
        <span style="font-weight: 600; color: var(--text);">S·ªë trang</span>
        <input name="num_pages" type="number" min="1" step="1" placeholder="320" value="{{ (book.num_pages if book and book.num_pages is not none else '') }}" style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);">
        <small style="color: var(--muted); font-size: 12px;">T·ªïng s·ªë trang</small>
      </label>
    </div>
  </div>
  
  <!-- M√¥ t·∫£ -->
  <div class="form-section" style="margin-bottom: 32px;">
    <h3 style="color: var(--text); margin: 0 0 20px 0; font-size: 18px; border-bottom: 2px solid #8b5cf6; padding-bottom: 8px;">üìù M√¥ t·∫£ s√°ch</h3>
    
    <label style="display: flex; flex-direction: column; gap: 8px;">
      <span style="font-weight: 600; color: var(--text);">T√≥m t·∫Øt n·ªôi dung</span>
      <textarea name="description" rows="6" placeholder="Nh·∫≠p m√¥ t·∫£ chi ti·∫øt v·ªÅ n·ªôi dung, ch·ªß ƒë·ªÅ v√† gi√° tr·ªã c·ªßa cu·ªën s√°ch..." style="padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--text); resize: vertical;">{{ (book.description if book else '') }}</textarea>
      <small style="color: var(--muted); font-size: 12px;">M√¥ t·∫£ chi ti·∫øt v·ªÅ n·ªôi dung v√† gi√° tr·ªã c·ªßa s√°ch (khuy·∫øn ngh·ªã 200-500 t·ª´)</small>
    </label>

    {% if is_edit and book %}
    <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap">
      <form method="post" action="{{ url_for('admin_enhance_book_description', book_id=book.id) }}" onsubmit="return confirm('T·∫°o m√¥ t·∫£ d√†i v√† h·∫•p d·∫´n h∆°n cho s√°ch n√†y?')">
        <button class="btn secondary" type="submit">Vi·∫øt m√¥ t·∫£ d√†i h∆°n</button>
      </form>
      <form method="post" action="{{ url_for('admin_generate_review_for_book', book_id=book.id) }}" onsubmit="return confirm('T·∫°o review bi√™n t·∫≠p cho s√°ch n√†y?')">
        <button class="btn secondary" type="submit">T·∫°o review bi√™n t·∫≠p</button>
      </form>
    </div>
    {% endif %}
  </div>
  <!-- Actions -->
  <div class="form-actions" style="display: flex; gap: 12px; justify-content: flex-end; padding-top: 24px; border-top: 1px solid var(--border);">
    <a class="btn secondary" href="{{ url_for('admin_books') }}" style="text-decoration: none;">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      <span>H·ªßy b·ªè</span>
    </a>
    <button class="btn" type="submit" style="display: flex; align-items: center; gap: 8px;">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
        <polyline points="17,21 17,13 7,13 7,21"/>
        <polyline points="7,3 7,8 15,8"/>
      </svg>
      <span>{% if is_edit %}C·∫≠p nh·∫≠t s√°ch{% else %}L∆∞u s√°ch m·ªõi{% endif %}</span>
    </button>
  </div>
{% endif %}
  </form>
</div>

<!-- H∆∞·ªõng d·∫´n v√† li√™n k·∫øt -->
<div class="form-help" style="background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin: 24px 0;">
  <h3 style="color: var(--text); margin: 0 0 16px 0; font-size: 18px;">üí° H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</h3>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
    <div>
      <h4 style="color: var(--primary); margin: 0 0 8px 0; font-size: 14px;">üìã Th√¥ng tin b·∫Øt bu·ªôc</h4>
      <ul style="color: var(--muted); margin: 0; font-size: 13px; line-height: 1.5; padding-left: 16px;">
        <li>M√£ s√°ch: ƒê·ªãnh danh duy nh·∫•t</li>
        <li>Ti√™u ƒë·ªÅ: T√™n ƒë·∫ßy ƒë·ªß c·ªßa s√°ch</li>
        <li>T√°c gi·∫£: T√™n t√°c gi·∫£ ch√≠nh</li>
      </ul>
    </div>
    <div>
      <h4 style="color: var(--accent); margin: 0 0 8px 0; font-size: 14px;">üè∑Ô∏è Ph√¢n lo·∫°i</h4>
      <ul style="color: var(--muted); margin: 0; font-size: 13px; line-height: 1.5; padding-left: 16px;">
        <li>Danh m·ª•c: Ph√¢n lo·∫°i ch√≠nh</li>
        <li>Th·ªÉ lo·∫°i: Ph√¢n lo·∫°i ph·ª•</li>
        <li>Tags: T·ª´ kh√≥a t√¨m ki·∫øm</li>
      </ul>
    </div>
    <div>
      <h4 style="color: #fbbf24; margin: 0 0 8px 0; font-size: 14px;">üîó Qu·∫£n l√Ω</h4>
      <div style="display: flex; gap: 12px; flex-wrap: wrap;">
        <a href="{{ url_for('admin_categories') }}" class="btn secondary" style="text-decoration: none; font-size: 12px; padding: 6px 12px;">üìÇ Danh m·ª•c</a>
        <a href="{{ url_for('admin_tags') }}" class="btn secondary" style="text-decoration: none; font-size: 12px; padding: 6px 12px;">üè∑Ô∏è Tags</a>
        <a href="{{ url_for('admin_books') }}" class="btn secondary" style="text-decoration: none; font-size: 12px; padding: 6px 12px;">üìö Danh s√°ch</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

