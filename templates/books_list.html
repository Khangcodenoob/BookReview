{% extends 'base.html' %}
{% block title %}Danh s√°ch s√°ch{% endblock %}
{% block content %}
<div class="page-header">
  <h1 class="page-title">Th∆∞ vi·ªán s√°ch</h1>
  <p class="page-subtitle">Kh√°m ph√° b·ªô s∆∞u t·∫≠p s√°ch phong ph√∫ c·ªßa ch√∫ng t√¥i</p>
</div>

<div class="filters-section">
  <form method="get" class="filters-form">
    <div class="filter-group">
      <div class="search-group">
        <input type="text" name="q" placeholder="T√¨m ki·∫øm s√°ch, t√°c gi·∫£..." value="{{ q }}" class="search-field">
        <button class="btn btn-primary" type="submit">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="M21 21l-4.35-4.35"/>
          </svg>
          T√¨m ki·∫øm
        </button>
      </div>
    </div>
    
    <div class="filter-row">
      <div class="filter-item">
        <label>Th·ªÉ lo·∫°i</label>
        <select name="genre" class="filter-select">
          <option value="">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>
          {% for g in genres %}
            <option value="{{ g }}" {% if selected_genre==g %}selected{% endif %}>{{ g }}</option>
          {% endfor %}
        </select>
      </div>
      
      <div class="filter-item">
        <label>S·∫Øp x·∫øp</label>
        <select name="sort" class="filter-select">
          <option value="new" {% if sort=='new' %}selected{% endif %}>M·ªõi nh·∫•t</option>
          <option value="az" {% if sort=='az' %}selected{% endif %}>A ‚Üí Z</option>
          <option value="za" {% if sort=='za' %}selected{% endif %}>Z ‚Üí A</option>
        </select>
      </div>
      
      <div class="filter-item">
        <label>Nh√† xu·∫•t b·∫£n</label>
        <input type="text" name="publisher" placeholder="VD: NXB Tr·∫ª" value="{{ publisher or '' }}" class="filter-input">
      </div>
      
      <div class="filter-actions">
        <a class="btn btn-secondary" href="{{ url_for('books_list') }}">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/>
          </svg>
          Xo√° l·ªçc
        </a>
      </div>
    </div>
  </form>
</div>

{% if books %}
<div class="books-grid">
  {% for book in books %}
    <a class="card" href="{{ url_for('book_detail', book_id=book.id) }}" style="animation-delay: {{ loop.index0 * 0.1 }}s">
      <div class="cover">
        <img src="{{ book.cover_url or url_for('static', filename='placeholder.jpg') }}" alt="{{ book.title }}" loading="lazy">
        <div class="cover-overlay">
          <div class="book-genre">{{ book.genre }}</div>
        </div>
      </div>
      <div class="card-body">
        <h3 class="book-title">{{ book.title }}</h3>
        <p class="book-author">{{ book.author }}</p>
        <p class="book-desc">{{ (book.description or '')[:140] }}{% if (book.description or '')|length > 140 %}...{% endif %}</p>
        <div class="book-meta">
          <span class="book-genre-badge">{{ book.genre }}</span>
        </div>
      </div>
    </a>
  {% endfor %}
</div>

{% if total_pages > 1 %}
<div class="pagination">
  <div class="pagination-info">
    <span class="pagination-text">Hi·ªÉn th·ªã {{ (page-1)*per_page + 1 }}-{{ [page*per_page, total]|min }} trong {{ total }} k·∫øt qu·∫£</span>
  </div>
  <div class="pagination-controls">
    {% if page > 1 %}
      <a class="btn btn-secondary pagination-btn" href="{{ url_for('books_list', q=q, genre=selected_genre, publisher=publisher, sort=sort, page=page-1, per_page=per_page) }}">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
        Tr∆∞·ªõc
      </a>
    {% endif %}
    
    <div class="pagination-numbers">
      {% for p in range([1, page-2]|max, [total_pages+1, page+3]|min) %}
        {% if p == page %}
          <span class="pagination-number active">{{ p }}</span>
        {% else %}
          <a class="pagination-number" href="{{ url_for('books_list', q=q, genre=selected_genre, publisher=publisher, sort=sort, page=p, per_page=per_page) }}">{{ p }}</a>
        {% endif %}
      {% endfor %}
    </div>
    
    {% if page < total_pages %}
      <a class="btn btn-secondary pagination-btn" href="{{ url_for('books_list', q=q, genre=selected_genre, publisher=publisher, sort=sort, page=page+1, per_page=per_page) }}">
        Sau
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </a>
    {% endif %}
  </div>
</div>
{% endif %}

{% else %}
<div class="empty-state">
  <div class="empty-icon">üìö</div>
  <h3>Kh√¥ng t√¨m th·∫•y s√°ch n√†o</h3>
  <p>Th·ª≠ thay ƒë·ªïi t·ª´ kh√≥a t√¨m ki·∫øm ho·∫∑c b·ªô l·ªçc ƒë·ªÉ t√¨m th·∫•y s√°ch b·∫°n mu·ªën.</p>
  <a class="btn btn-primary" href="{{ url_for('books_list') }}">Xem t·∫•t c·∫£ s√°ch</a>
</div>
{% endif %}
{% endblock %}


